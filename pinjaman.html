<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Data Pinjaman</title>

<style>
 header{
  background:linear-gradient(135deg,#1e90ff,#4facfe);
  color:white;
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h3{margin:0}

header button{
  background:white;
  color:#1e90ff;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}
body{margin:0;font-family:Arial;background:#f4f6f9}
header{background:#1e90ff;color:#fff;padding:12px;display:flex;justify-content:space-between}
.container{padding:15px}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px}
input,select{width:100%;padding:10px;margin-bottom:8px;border-radius:8px;border:1px solid #ccc}
button{padding:10px;border:none;border-radius:8px;background:#1e90ff;color:white;font-weight:bold}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:center}
</style>
</head>

<body>

 <header>
  <h3>ðŸ’³ Pinjaman</h3>
  <div>
    <button onclick="location.href='dashboard.html'">dashboard</button>
  </div>
  <div>
<button onclick="location.href='transaksi.html'">back</button>
  </div>
</header>

<div class="container">

<select id="anggota"></select>

<label>Tanggal</label>
<input type="date" id="tglPinjam">

<label>Jumlah Pinjaman</label>
<input type="number" id="jumlah" placeholder="Jumlah pinjaman">

<label>Tenor (bulan)</label>
<input type="number" id="tenor" placeholder="Contoh: 10">

<label>Angsuran / bulan</label>
<input type="number" id="angsuran" readonly>

<button id="btnPinjam">Simpan Pinjaman</button>

<table>
<thead>
<tr>
 <th>Nama</th>
 <th>Tanggal</th>
 <th>Tenor</th>
 <th>Angsuran/bln</th>
 <th>Jumlah</th>
 <th>Sisa</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

</div>

<script src="js/storage.js"></script>
<script>
function rupiah(n){
 return "Rp "+Number(n||0).toLocaleString("id-ID");
}

function genID(){
 jumlah.addEventListener("input", hitungAngsuran);
tenor.addEventListener("input", hitungAngsuran);

function hitungAngsuran(){
 const j = Number(jumlah.value||0);
 const t = Number(tenor.value||0);

 if(j>0 && t>0){
  angsuran.value = Math.round(j/t);
 }else{
  angsuran.value = "";
 }
}
 return Date.now()+Math.floor(Math.random()*1000);
}

function loadAnggota(){
 const db=getDB();
 anggota.innerHTML="";
 db.anggota.forEach(a=>{
  anggota.innerHTML+=`<option value="${a.id}">${a.nama}</option>`;
 });
}


function loadPinjaman(){
 const db=getDB();
 list.innerHTML="";

 (db.pinjaman||[]).forEach(p=>{
  list.innerHTML+=`
   <tr>
    <td>${p.nama}</td>
    <td>${p.tanggal||"-"}</td>
    <td>${p.tenor||"-"} bln</td>
    <td>${rupiah(p.angsuran||0)}</td>
    <td>${rupiah(p.jumlah)}</td>
    <td>${rupiah(p.sisa)}</td>
   </tr>`;
 });
}
/* =====================
   SIMPAN PINJAMAN
===================== */

function simpanPinjaman(){

 const db = getDB();

 db.pinjaman ??= [];
 db.kas ??= [];

 const ag = db.anggota.find(a => a.id == anggota.value);
 const j = Number(jumlah.value);
 const ten = Number(tenor.value);
 const ang = Number(angsuran.value);
 const t = tglPinjam.value || new Date().toISOString().slice(0,10);

 if(!ag || j<=0 || ten<=0){
  alert("Lengkapi data");
  return;
 }

 db.pinjaman.push({
  id: genID(),
  anggota_id: ag.id,
  nama: ag.nama,
  jumlah: j,
  sisa: j,
  tenor: ten,
  angsuran: ang,
  tanggal: t
 });

 db.kas.push({
  id: genID(),
  tanggal: t,
  keterangan: "Pencairan Pinjaman " + ag.nama,
  jenis: "KELUAR",
  jumlah: j
 });

 saveDB(db);

 jumlah.value="";
 tenor.value="";
 angsuran.value="";
 loadPinjaman();

 alert("Pinjaman tersimpan");
}
 document.addEventListener("DOMContentLoaded", ()=>{

 loadAnggota();
 loadPinjaman();

 document.getElementById("btnPinjam")
   .addEventListener("click", simpanPinjaman);

});
</script>

</body>
</html>